<!DOCTYPE html>
<html>
<head>
   <meta charset="UTF-8">
   <title>Emotion Function</title>
   <script src="https://code.jquery.com/jquery-3.2.1.js" integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE=" crossorigin="anonymous"></script>
   <style>
      body, html { height: 100%; min-height: 100%; padding: 0; margin: 0}
      video { offset: 0, 0, 0, 0;  }
      canvas { display: none; }
      button { width: 100%; height: 150px; color: #ffffff; background-color: #3366ff; offset: 0,0,0,0; border: none; }
      #msg { font-size: 20px; color: #3366ff; width: 100%; height: 150px; }
   </style>
</head>
<body>
    <div class="center">
        <span id="msg">Emotion Func</span>
    </div>

    <video id="video" width="720" height="1280" autoplay></video>    
    <canvas id="canvas" width="720" height="1280" ></canvas>
    <button id="snap">Capture</button>    

    <script>
      var video = document.getElementById('video');
      if(navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        navigator.mediaDevices.getUserMedia({ video: true }).then(function(stream) {
          video.src = window.URL.createObjectURL(stream);
          video.play();
        });
      }

      var canvas = document.getElementById('canvas');
      var context = canvas.getContext('2d');
      var video = document.getElementById('video'); 

      document.getElementById("snap").addEventListener("click", function() {
	      
        video.pause();
        canvas.style.display = "block";
        context.drawImage(video, 0, 0, canvas.width, canvas.height);               
        var x = canvas.toDataURL("image/png"); 
        
        canvas.style.display = "none";

        $.ajax({
          url: "/api/EmotionChecker",
          type: "POST",
          data: x,
          contentType: "application/octet-stream",

          success: function (emotion) {            
            $("#msg").html("Emotion: " + emotion);            
            video.play();
          },
          error: function (xhr, status, error) {
            $("#msg").html(status+' '+error);
            video.play();
          }
        });
      });

   </script>
</body>
</html>